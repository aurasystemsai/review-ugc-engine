<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>AURA • Review UGC Admin</title>
    <style>
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter",
          sans-serif;
        background: #020617;
        color: #e5e7eb;
      }
      .shell {
        max-width: 960px;
        margin: 40px auto;
        padding: 0 20px;
      }
      h1 {
        font-size: 24px;
        margin-bottom: 4px;
      }
      p {
        margin-top: 0;
        color: #9ca3af;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 8px 10px;
        border-bottom: 1px solid #1f2937;
        font-size: 13px;
        vertical-align: top;
      }
      th {
        text-align: left;
        color: #9ca3af;
      }
      button {
        border-radius: 999px;
        border: none;
        padding: 4px 10px;
        font-size: 12px;
        cursor: pointer;
      }
      .btn-approve {
        background: #22c55e;
        color: #022c22;
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <h1>AURA • Review UGC Admin</h1>
      <p>Pending reviews waiting for moderation.</p>

      <table id="pending-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Product</th>
            <th>Rating</th>
            <th>Text</th>
            <th>AI score</th>
            <th>Created</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      const base =
        window.location.hostname === "localhost"
          ? "http://localhost:4001"
          : window.location.origin;

      function loadPending() {
        fetch(base + "/api/ugc/moderation/pending")
          .then((res) => res.json())
          .then((rows) => {
            const tbody = document.querySelector("#pending-table tbody");
            tbody.innerHTML = "";

            rows.forEach((row) => {
              const tr = document.createElement("tr");

              tr.innerHTML = `
                <td>${row.id}</td>
                <td>${row.product_id || ""}</td>
                <td>${row.rating || ""}</td>
                <td>${(row.text || "").slice(0, 120)}</td>
                <td>${row.ai_score ?? ""}</td>
                <td>${row.created_at || ""}</td>
                <td><button class="btn-approve" data-id="${
                  row.id
                }">Approve</button></td>
              `;

              tbody.appendChild(tr);
            });

            document.querySelectorAll(".btn-approve").forEach((btn) => {
              btn.addEventListener("click", () => {
                const id = btn.getAttribute("data-id");
                approve(id);
              });
            });
          })
          .catch((err) => console.error("Load pending error", err));
      }

      function approve(id) {
        fetch(base + "/api/ugc/moderation/" + id + "/approve", {
          method: "POST"
        })
          .then((res) => {
            if (!res.ok) throw new Error("HTTP " + res.status);
            return res.json();
          })
          .then(() => loadPending())
          .catch((err) => console.error("Approve error", err));
      }

      loadPending();
    </script>
  </body>
</html>
